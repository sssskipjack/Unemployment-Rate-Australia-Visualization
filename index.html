<!DOCTYPE html>
<html>
<head>
  <!-- Import Vega & Vega-Lite -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5.20.2"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.1.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.17.0"></script>
  
  <!-- CSS file -->
  <link rel="stylesheet" type="text/css" href="css/styles.css" media="all">
  
  <!-- Optional: Remove Favicon Link if favicon.ico is not present -->
  <!-- <link rel="icon" href="favicon.ico" type="image/x-icon"> -->
  
</head>
<body>
  
  <div id="symbol_map"></div>
  
  <script type="text/javascript">
    const spec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": 800,
      "height": 600,
      "title": {
        "text": "Unemployment Rates by Australian State",
        "fontSize": 20,
        "anchor": "middle",
        "color": "#333"
      },
      "projection": {
        "type": "mercator",
        "scale": 1000,
        "center": [134, -25],
        "translate": [400, 300]
      },
      "background": "#f9f9f9",
      "layer": [
        {
          "data": {
            "values": [{}],
            "transform": [
              {"type": "graticule", "extent": [[95, -44], [155, -10]], "step": [30, 30]}
            ]
          },
          "mark": {
            "type": "geoshape",
            "stroke": "#ddd",
            "fill": "none"
          }
        },
        {
          "data": {
            "url": "js/georef-australia-state-millesime.json",
            "format": {
              "type": "topojson",
              "feature": "georef-australia-state-millesime"
            }
          },
          "mark": {
            "type": "geoshape",
            "fill": "#ffffff",
            "stroke": "#999999",
            "strokeWidth": 1
          }
        },
        {
          "data": {
            "url": "js/georef-australia-state-millesime.json",
            "format": {
              "type": "topojson",
              "feature": "georef-australia-state-millesime"
            }
          },
          "transform": [
            {
              "calculate": "datum.properties.ste_name.substring(2, datum.properties.ste_name.length - 2)",
              "as": "ste_name_clean"
            },
            {
              "lookup": "ste_name_clean",
              "from": {
                "data": {
                  "url": "data/unemploymentRate.csv"
                },
                "key": "State",
                "fields": ["UnemploymentRate"]
              }
            },
            {
              "calculate": "datum.UnemploymentRate != null ? parseFloat(datum.UnemploymentRate.substring(0, datum.UnemploymentRate.length - 1)) : null",
              "as": "UnemploymentRateNum"
            }
          ],
          "mark": {
            "type": "geoshape",
            "stroke": "#ffffff",
            "strokeWidth": 1
          },
          "encoding": {
            "color": {
              "field": "UnemploymentRateNum",
              "type": "quantitative",
              "title": "Unemployment Rate (%)",
              "scale": {
                "scheme": "blues"
              }
            },
            "tooltip": [
              {"field": "ste_name_clean", "type": "nominal", "title": "State"},
              {"field": "UnemploymentRateNum", "type": "quantitative", "title": "Unemployment Rate (%)"}
            ]
          }
        }
      ]
    };

    vegaEmbed('#symbol_map', spec, {actions: false}).then(function(result) {
      // Access the Vega view instance if needed
    }).catch(console.error);
  </script>
  
</body>
</html>
